{% extends 'model_overview.html' %}

{% block title %}Algorithm Overview{% endblock %}

{% block heading %}
    <h2 class="mt-3 mb-3">Own Algorithms</h2>
    <button class="btn btn-outline-dark mt-3 mb-3 ml-auto mr-3 dropdown-toggle" id="sortByButton" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">Sort by {{ view.kwargs.sort }}</button>
    <ul class="dropdown-menu mr-5" aria-labelledby="sortByButton">
        <li><a href="{% url 'algorithm_overview_sorted' 'name' %}" class="dropdown-item btn-secondary">Name</a></li>
        <li><a href="{% url 'algorithm_overview_sorted' 'group' %}" class="dropdown-item btn-secondary">Group</a></li>
        <li><a href="{% url 'algorithm_overview_sorted' 'upload_date' %}" class="dropdown-item btn-secondary">Upload
            date</a></li>
    </ul>
    <a href="{% url 'algorithm_upload' %}" class="mt-3 mb-3 btn btn-outline-dark">Upload algorithm</a>
{% endblock %}

{% block card-header %}
    <h5 class="mb-0 flex-grow-1">
        <a class="btn-link btn-block text-white{% if not forloop.first %} collapsed{% endif %}"
           aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}"
           aria-controls="collapse_{{ model.pk }}">
            {{ model.name }}
        </a>
    </h5>
    <div class="d-flex justify-content-center">
        {% if model.upload_date %}
            <a class="text-white mr-5">{{ model.upload_date }}</a>
        {% endif %}
        <a class="text-white">{{ model.group }}</a>
    </div>
{% endblock %}

{% block card-body %}
    {{ model.description }}
{% endblock %}

{% block card-footer %}
    <style>
        .modal-dialog{
            overflow-y: initial !important
        }
        .modal-body{
            height: calc(20vh - 50px);
            overflow-y: auto;
        }
    </style>

    <ul class="list-group list-group-flush">
        <li class="list-group-item">
            <div class="d-flex flex-row-reverse">

                <a href="#delete-algorithm-{{ model.pk }}"
                   class="btn btn-danger mr-3"
                   data-toggle="modal">Delete</a>

                {% if model.experiment_set.count > 0 %}
                    <div class="modal fade"
                         id="delete-algorithm-{{ model.pk }}"
                         tabindex="-1"
                         role="dialog"
                         aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <div class="text-left">
                                        <h5><b>Error</b></h5><br/>
                                        Algorithm cannot be deleted, since it is used in these experiments:
                                    </div>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div class="text-center">
                                        <div class="container">
                                            <ul style="list-style: none;">
                                                {% for exp in model.experiment_set.get_queryset %}
                                                    <li>{{ exp.display_name }}</li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger mr-3" data-dismiss="modal">Cancel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="modal fade"
                         id="delete-algorithm-{{ model.pk }}"
                         tabindex="-1"
                         role="dialog"
                         aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <div class="text-left">
                                        <h5><b>Warning</b></h5><br/>
                                    </div>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div class="text-center">
                                        Are you sure you want to delete this algorithm?
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <form action="{% url 'algorithm_delete' model.pk %}" method="post">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-success mr-3">Yes</button>
                                        <button type="button" class="btn btn-danger mr-3" data-dismiss="modal">Cancel</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <a href="{% url 'algorithm_edit' model.pk %}"
                   class="btn btn-warning mr-3">Edit</a>
            </div>
        </li>
    </ul>
{% endblock %}