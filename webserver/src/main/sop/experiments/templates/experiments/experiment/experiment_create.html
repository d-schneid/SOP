{% extends 'base.html' %}
{% load algorithm_filters %}

{% block title %}
    Create Experiment
{% endblock %}

{% block content %}
    <style>
        .hand {
            cursor: pointer;
        }
    </style>

    <form method="post">{% csrf_token %}
        <div class="card shadow mt-4 mb-4">
            <div class="card-header bg-dark d-flex">
                <div class="flex-fill">{{ form.display_name }}</div>
            </div>
            <div class="card-body show mb-3">
                <div class="d-flex flex-column">
                    <div>
                        {{ form.dataset.errors }}
                        <label for="{{ form.dataset.id_for_label }}">Dataset:</label>
                        <select name="dataset" class="form-control" required id="{{ form.dataset.id_for_label }}">
                            <option value="">---------</option>
                            {% for dataset in datasets %}
                                <option value="{{ dataset.pk }}"
                                        {% if dataset.pk|slugify == form.dataset.value %} selected {% endif %}
                                        {% if not dataset.is_cleaned %} disabled
                                        {% if dataset.has_error %}style="color: #ff0000" {% endif %}
                                        {% endif %}>
                                    {{ dataset.get_representation }}
                                    {% if not dataset.is_cleaned %}{% if not dataset.has_error %}(cleaning in progress,
                                        try again later){% else %}(cleaning failed){% endif %}{% endif %}
                                </option>
                            {% endfor %}

                        </select>
                    </div>
                    <div class="mt-3">
                        <label>Algorithms:</label>
                        {% for group in algorithm_groups %}
                            {% if algorithms|in_group:group %}
                                <div class="card shadow mt-1 mb-4">
                                    <div class="card-header bg-dark d-flex hand text-white" data-toggle="collapse"
                                         data-target="#collapse_{{ group|cut:" " }}" id="group_{{ group|cut:" " }}">
                                        <div class="flex-grow-1">{{ group }}</div>
                                    </div>
                                    <div id="collapse_{{ group|cut:" " }}" class="collapse"
                                         aria-labelledby="group_{{ group|cut:" " }}">
                                        <div class="card-body mr-1 ml-1 mb-1 mt-1">
                                            <div class="list-group">
                                                {% for algorithm in algorithms %}
                                                    {% if algorithm.group == group %}
                                                        <label class="list-group-item">
                                                            <span class="ml-2">
                                                                <input class="form-check-input me-1"
                                                                       type="checkbox"
                                                                       value="{{ algorithm.pk }}"
                                                                       name="check-algo"
                                                                       id="check-algo-{{ algorithm.pk }}"
                                                                        {% if algorithm in initial_algorithms %}
                                                                       checked
                                                                        {% endif %}
                                                                >
                                                                {{ algorithm.display_name }}
                                                            </span>
                                                        </label>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}

                    </div>
                </div>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    <div class="d-flex mb-1 mt-1">
                        <a class="btn btn-dark" href="{% url "experiment_overview" %}">Cancel</a>
                        <button class="btn btn-success ml-auto" type="submit">Create</button>
                    </div>
                </li>
            </ul>
        </div>
    </form>
{% endblock %}
