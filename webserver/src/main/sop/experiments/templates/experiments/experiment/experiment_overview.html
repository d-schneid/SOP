{% extends 'model_overview.html' %}

{% block title %}Experiment Overview{% endblock %}

{% block heading %}
    <h2 class="mt-3 mb-3">Own Experiments</h2>
    <button class="btn btn-outline-dark mt-3 mb-3 ml-auto mr-3 dropdown-toggle" id="sortByButton" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">Sort by {{ view.kwargs.sort }}</button>
    <ul class="dropdown-menu mr-5" aria-labelledby="sortByButton">
        <li><a href="{% url 'experiment_overview_sorted' 'name' %}" class="dropdown-item btn-secondary">Name</a></li>
        <li><a href="{% url 'experiment_overview_sorted' 'creation_date' %}" class="dropdown-item btn-secondary">Creation
            date</a></li>
    </ul>
    <a href="{% url 'experiment_create' %}" class="mt-3 mb-3 btn btn-outline-dark">Create experiment</a>
{% endblock %}

{% block card-header %}
    <h5 class="flex-grow-1 mb-0">
        <a class="btn-link btn-block text-white{% if not forloop.first %} collapsed{% endif %}"
           aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}"
           aria-controls="collapse_{{ model.pk }}">
            {{ model.display_name }}
        </a>
    </h5>
    <div class="ml-3 mr-1 text-white">
        Execuions: {{ model.execution_set.all.count }}
    </div>
{% endblock %}

{% block card-body %}
    <div class="d-flex">
        <a>{{ model.creation_date }}</a>

        <a href="{% url 'execution_create' model.pk %}"
           class="btn btn-success ml-auto">Create Execution</a>
    </div>
    <div class="d-flex">
        <a>Dataset: {{ model.dataset.display_name }}</a>
    </div>
    <div class="d-flex">
        <a>
            Algorithms:
            {{ model.algorithms.all|join:", " }}
        </a>
    </div>
{% endblock %}

{% block card-footer %}
    {% for execution in model.execution_set.all %}
        <ul class="list-group list-group-flush">
            <li class="list-group-item">
                <div class="d-flex">
                    <a class="flex-fill">Execution {{ forloop.counter }}</a>
                    <a class="flex-fill">{{ execution.status }}</a>
                    <a class="flex-fill">{{ execution.progess }}</a>
                    <a class="flex-fill">{{ execution.creation_date }}</a>
                    <button type="button"
                            class="btn btn-danger mr-3"
                            data-toggle="modal"
                            data-target="#deleteModal{{ execution.pk }}">
                        Delete
                    </button>
                    <div class="modal fade"
                         id="deleteModal{{ execution.pk }}"
                         tabindex="-1"
                         role="dialog"
                         aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <div class="text-left">
                                        <h5><b>Warning</b></h5><br/>
                                    </div>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div class="text-center">
                                        Are you sure you want to delete execution <b>{{ forloop.counter }}</b>?
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <form action="{% url 'execution_delete' model.pk execution.pk %}" method="post">
                                        {% csrf_token %}
                                        <button class="btn btn-success mr-3" type="submit">Delete</button>
                                    </form>
                                    <button type="button" class="btn btn-danger mr-3" data-dismiss="modal">Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    {% endfor %}
    <ul class="list-group list-group-flush">
        <li class="list-group-item">
            <div class="d-flex flex-row-reverse">
                <button type="button"
                        class="btn btn-danger mr-3"
                        data-toggle="modal"
                        data-target="#deleteModal{{ model.pk }}">
                    Delete Experiment
                </button>
                <div class="modal fade"
                     id="deleteModal{{ model.pk }}"
                     tabindex="-1"
                     role="dialog"
                     aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <div class="text-left">
                                    <h5><b>Warning</b></h5><br/>
                                </div>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="text-center">
                                    Are you sure you want to delete experiment <b>{{ model.display_name }}</b>?
                                </div>
                            </div>
                            <div class="modal-footer">
                                <form action="{% url 'experiment_delete' model.pk %}" method="post">
                                    {% csrf_token %}
                                    <button class="btn btn-success mr-3" type="submit">Delete</button>
                                </form>
                                <button type="button" class="btn btn-danger mr-3" data-dismiss="modal">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
                <a href="{% url 'experiment_edit' model.pk %}"
                   class="btn btn-warning mr-3">Edit Experiment</a>
            </div>
        </li>
    </ul>
{% endblock %}